knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
library(tidyverse)
library(lubridate)
source("./scripts/viridis.R")
source("./scripts/ggprob.R")
# get all dates
file_list <- list.files(path="./data")
# load all data
allData <- data.frame()
for(i in 1:length(file_list)){
# get file names
league <- paste("./data/", file_list[i], "/LeagueTable.csv", sep="")
standard <- paste("./data/", file_list[i], "/SquadStandardStats.csv", sep="")
goalkeep <- paste("./data/", file_list[i], "/SquadGoalkeeping.csv", sep="")
# load in each data table and merge it together
LeagueTable <- read.csv(league)
if( file.exists(standard) ){
SquadStandardStats <- read.csv(standard)
LeagueTable <- full_join(LeagueTable, SquadStandardStats, by="Squad")
}
if( file.exists(goalkeep) ){
SquadGoalkeeping <- read.csv(goalkeep)
LeagueTable <- full_join(LeagueTable, SquadGoalkeeping, by="Squad")
}
# add year column to the data
LeagueTable <- select(LeagueTable, -contains(".y")) %>%
mutate(year = substr(file_list[i], 6, 9))
LeagueTable <- LeagueTable %>%
top_n(LeagueTable, 20)
# combine the data into one big table
if( i != 1){
LeagueTable[setdiff(names(allData), names(LeagueTable))] <- NA
allData[setdiff(names(LeagueTable), names(allData))] <- NA
}
allData <- rbind(allData, LeagueTable)
}
allData
savesAndGoals <- allData %>%
mutate(Rk =
case_when(
Rk == 1 ~ "Champion",
TRUE ~ "Not Champion",
)
) %>%
group_by(Rk) %>%
select(Saves, GF, GA.x, Rk) %>%
drop_na()
savesAndGoals %>%
ggplot(aes(x=Saves, y=GF, color=as.factor(Rk))) +
geom_point(alpha = 0.5) +
geom_smooth(method="lm", se = FALSE) +
scale_color_manual(values = c("#e05a5e", "#58e0d5")) +
labs(color = "Season Champion") +
ggtitle("Goals vs Saves", subtitle = "By Chamion and Non-Champion teams") +
xlab("Saves (in a season)") +
ylab("Goals For (in a season)")
sgChamp <- savesAndGoals %>%
filter(Rk == "Champion")
sgNonChamp <- savesAndGoals %>%
filter(Rk != "Champion")
champLm <- lm(Saves~GF, sgChamp)
nonChampLm <-  lm(Saves~GF, sgNonChamp)
b <- allData %>%
filter(allData$Saves != "N/A") %>%
filter(Rk == "1") %>%
mutate(year = as.numeric(year)) %>%
select(GF, year)
b %>%
ggplot(aes(x = year, y = GF)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
lm1 <- lm(GF~year, b)
library(modelr)
b <- b %>%
add_residuals(lm1) %>%
add_predictions(lm1)
ggplot(b, aes(x=year, y =resid)) +
geom_point() +
xlab("x") +
ylab("Residuals") +
geom_hline(aes(yintercept=0), color="red", linetype = "dashed")
lm1
ci_b <- b %>%
pull(Gls)
ci_b <- b %>%
pull(GF)
t.test(ci_b)
t.test(ci_b)
b <- allData %>%
filter(allData$Saves != "N/A") %>%
filter(Rk == "1") %>%
mutate(year = as.numeric(year)) %>%
select(GF, year)
b %>%
ggplot(aes(x = year, y = GF)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
lm1 <- lm(GF~year, b)
library(modelr)
b <- b %>%
add_residuals(lm1) %>%
add_predictions(lm1)
ggplot(b, aes(x=year, y =resid)) +
geom_point() +
xlab("x") +
ylab("Residuals") +
geom_hline(aes(yintercept=0), color="red", linetype = "dashed")
