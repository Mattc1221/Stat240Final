---
title: "STAT 240 Final Project"
output: html_document
---

## **Team Members**
Matthew Chiang, Siyu Huang, Vishnu Yaragadda

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
library(tidyverse)
library(lubridate)
source("./scripts/viridis.R")
source("./scripts/ggprob.R")
```

```{r cache=TRUE, cache.path="cache/", include=TRUE}
# get all dates
file_list <- list.files(path="./data")

# load all data
allData <- data.frame()
for(i in 1:length(file_list)){ # REPLACE 15:16 with  1:length(file_list)
  if(file_list[i] == "2017-2018" || file_list[i] == "2018-2019" || file_list[i] == "2019-2020"){
    next
  }
  
  # get file names
  league <- paste("./data/", file_list[i], "/LeagueTable.csv", sep="")
  standard <- paste("./data/", file_list[i], "/SquadStandardStats.csv", sep="")
  goalkeep <- paste("./data/", file_list[i], "/SquadGoalkeeping.csv", sep="")
  
  # load in each data table and merge it together
  LeagueTable <- read.csv(league)
  if( file.exists(standard) ){
    SquadStandardStats <- read.csv(standard)
    LeagueTable <- full_join(LeagueTable, SquadStandardStats, by="Squad")
  }
  if( file.exists(goalkeep) ){
    SquadGoalkeeping <- read.csv(goalkeep)
    LeagueTable <- full_join(LeagueTable, SquadGoalkeeping, by="Squad")
  }
  
  
  # add year column to the data
  LeagueTable <- select(LeagueTable, -contains(".y")) %>%
    mutate(year = substr(file_list[i], 6, 9))
  
  LeagueTable <- LeagueTable %>% 
    top_n(LeagueTable, 20)
  
  # combine the data into one big table
  allData <- rbind(allData, LeagueTable)
}
allData
```

## **Introduction**

**NEED TO PUT SOMETHING HERE!**


## **Background**

> Raw Data:

We found data for the La Liga Soccer League. Each season from 1988-2020, there are multiple sets of data ranging from team rankings, top scorers, standard squad statistics, team goalkeeping, team shooting, to statistics on individual players. We selected three sets of data:

* League Table: includes team rankings, total wins, loses, goals for, goals against, etc.
* Squad Standard Stats: includes general performance statistics of each team.
* Squad Goalkeeping: includes performance statistics for the goalkeeping of each team.

> Final Data: 

We had to collect the above data for the seasons between 1988-2020. We combined all of the data into one large dataframe by the team name and created a year column to keep track of which teams data cooresponds to which year.

> Data Citation:

"La Liga Seasons", Real Federación Española de Fútbol, 7th April 2020, https://fbref.com/en/comps/12/history/La-Liga-Seasons 
 
> Focus:
 
The overall aim of our analysis on this data will be to determine the characteristics of the winning team in the 2020-2021 La Liga Soccer League.


## **Analysis**

> Question 1: Description. Firstly, we want to analyze the most direct factor that decides La Liga's winner of each season, that is the points each team get after 38 matches. In this league system, teams receive three points for a win, one point for a draw, and no points for a loss. Teams are ranked by total points, with the highest-ranked club at the end of the season crowned champion. From XXXX to 20XX, each winner's final point are gathered and we do the confidence interval on distribution to estimate the number of points that a champion should get. 

-- **Siyu** put ur stuff here
```{R}
champions <- allData %>% 
  filter(Rk == 1)

mean_pt = mean(champions$Pts)
z_pt = 1.960 #this is the 95% confidence level value
s_pt = sd(champions$Pts)
n_pt = nrow(champions)
CI_pt = mean_pt + c(-1,1) * z_pt * s_pt / sqrt(n_pt)
gnorm(mean_pt, s_pt, color = 'cyan') +
  geom_vline(xintercept = CI_pt[1], color = 'hotpink', linetype = 2) +
  geom_vline(xintercept = CI_pt[2], color = 'hotpink', linetype = 2) +
  geom_text(aes(CI_pt[1],-0.001,label=round(CI_pt[1]))) +
  geom_text(aes(CI_pt[2],-0.001,label=round(CI_pt[2]))) +
  ggtitle('Normal distributions of champions points') +
  xlab('points')
```
From the distribution graph, we estimate that the winning point of 95% confidence interval should be between approximately 74 to 84.

```{R}
mean_wins = mean(champions$W.x)
z_wins = 1.960 #this is the 95% confidence level value
s_wins = sd(champions$W.x)
n_wins = nrow(champions)
CI_wins = mean_wins + c(-1,1) * z_wins * s_wins / sqrt(n_wins)
gnorm(mean_wins, s_wins, color = 'cyan') +
  geom_vline(xintercept = CI_wins[1], color = 'hotpink', linetype = 2) +
  geom_vline(xintercept = CI_wins[2], color = 'hotpink', linetype = 2) +
  geom_text(aes(CI_wins[1],-0.002,label=round(CI_wins[1]))) +
  geom_text(aes(CI_wins[2],-0.002,label=round(CI_wins[2]))) +
  ggtitle('Normal distributions of champions wins') +
  xlab('Number of Wins')
```
From the distribution graph, we estimate that the number of wins of 95% confidence interval should be between approximately 25 to 27.

> Analysis: To conclude, we will have 95% confidence to say that the champion of the current season of La Liga will win 25 to 27 matches and get 74 to 84 points.

> Question 2: Description

-- **Vishnu** put ur stuff here, also check to see if I spelled ur last name right at the top of the doc

Analysis: ...












